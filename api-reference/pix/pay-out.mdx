## PayIn Flows

### How it works
To initiate a PIX payment, a payer can scan the code using their PIX payment app (such as Itau, NuBank, etc.). These codes comply with BCB’s infrastructure requirements to ensure that the merchant's details are stored securely and there are no errors during the payment journey.

### Key Steps
#### Flow
1. Merchant platforms can create a dynamic QR code by passing the relevant parameter using Paysecure’s API.
2. The platform can display the dynamic QR code on its app or any website at checkout or on a third-party app.
3. The payer scans the QR code from the PIX app of their choice on their mobile.
4. The payer authorizes the transaction on the app by entering a valid PIN.
5. Once the payment is done, the merchant platform receives a transaction status callback from Paysecure to a pre-configured endpoint.
6. The platform can also check the request status using the reference ID generated from the collection request using the Check Payment Status API.

## PayOut Flows

### How it works
To initiate a payout, the merchant has to give Paysecure the PIX details such as the recipient's PIX key (e.g., CPF/CNPJ, phone number, or email), amount, and any additional information.

If the merchant has enough balance, then the transaction amount will be deducted from the merchant balance and sent to the user.

### Flow
#### **POST Create PayOut**
```plaintext
https://api.paysecure.net/api/v1/payout/
```
To initiate a payout, the very first call to make is `/payout/` with the required data in the request body.

### Parameters
| Parameter | Notes |
|-----------|-------|
| `client.full_name` |  |
| `client.documentId` | Document Type Supported:  
cpf='tax_id Brazil'  
cnpj='tax_id Brazil company'  
evp='random key generated by the bank'  
email='email as key to receive pix'  
phone='phone as key to receive pix' |
| `client.documentType` |  |
| `payoutMethod` |  |
| `Amount` |  |
| `Currency` | Note: This is the currency account for which you have balance |
| `success_redirect` | URL to send the user if the transaction is successful |
| `failure_redirect` | URL to send the user if the transaction is unsuccessful |
| `Purpose` |  |

### **Request Body**
```json
{
   "client": {
       "email": "test@gmail.com",
       "full_name": "Test test",
       "documentId": "97c1c590-554b-4449-a0f1-8da9f9756937",
       "documentType": "evp"
   },
   "purpose": "payout to test",
   "payoutMethod": "Payout-PIX",
   "amount": 10,
   "currency": "BRL",
   "success_callback": "https://Success.com",
   "failure_callback": "https://failure.com"
}
```
To generate a PayOut, you are required to provide the API key (in the header), which can be located in the Dashboard section of your merchant account login.

### **Process Overview**
#### **Initiation:**
1. User initiates: The process starts with a user requesting a payout from the merchant.
2. Merchant approval: If everything is OK, the merchant approves the payout request.

#### **Processing:**
1. Payment details: Using Paysecure’s API, the merchant provides the recipient's Pix key (which can be a phone number, email, CPF/CNPJ, or random key) and the transfer amount.
2. Funds check: Paysecure verifies if sufficient funds are available in the merchant account to cover the transfer.
3. Processing & Key mapping: The recipient's Pix key is validated using the DICT (Transactional Identifier Directory). This central database links Pix keys with users' bank accounts.

#### **Payout:**
1. **Instant transfer:** If everything checks out, the payer's bank instantly transfers the funds to the recipient's bank account. The recipient typically receives confirmation messages from their respective bank about the successful transaction.

### **Example Request**
```bash
curl --location 'https://api.paysecure.net/api/v1/payout/' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer Token' \
--data-raw '{
   "client": {
       "email": "test@gmail.com",
       "full_name": "Test test",
       "documentId": "97c1c590-554b-4449-a0f1-8da9f9756937",
       "documentType": "evp"
   },
   "purpose": "payout to test",
   "payoutMethod": "Payout-PIX",
   "amount": 10,
   "currency": "BRL",
   "success_callback": "https://Success.com",
   "failure_callback": "https://failure.com"
}'
```

### **Example Response**
```json
{
   "payoutId": "65f93895c96bae142f7b1765",
   "client": {
       "email": "customer141@email.uk",
       "full_name": "Test Person-uk",
       "documentId": "97c1c590-554b-4449-a0f1-8da9f9756937",
       "documentType": "evp"
   },
   "updated_on": 1710831765,
   "payoutMethod": "Payout-PIX",
   "amountUnit": "MAJOR",
   "amount": 20.0,
   "errorMsg": "errors.wallet.transfer_balance_insufficient",
   "created_on": 1710831768,
   "merchantRef": "65f93895c96bae142f7b1765",
   "merchantName": "test",
   "status": "ERROR",
   "status_history": [
       {
           "status": "created",
           "timestamp": 1710831765
       },
       {
           "status": "error",
           "timestamp": 1710831768
       }
   ],
   "currency": "EUR",
   "success_callback": "https://Success.com",
   "failure_callback": "https://failure.com"
}
```

## **GET Payout Status**

### **Endpoint**
```plaintext
https://api.paysecure.net/api/v1/getpayout/{payoutId}/
```
This API provides details of a Payout, including its history.

### **Mandatory Parameter**
- `payoutId` must be passed in the API URL.

### **Possible Status Values**
| Status | Notes |
|--------|-------|
| `paid` | Transaction Successful |
| `payout_in_process` | Payout is under Processing. |
| `error` | Transaction has Failed. |

> The webhook will only be triggered for `paid` transactions or `errors`.

### **Example Request**
```bash
curl --location -g 'https://api.paysecure.net/api/v1/getpayout/{payoutId}/'
```
